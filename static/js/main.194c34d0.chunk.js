(this["webpackJsonpmoney-chat"]=this["webpackJsonpmoney-chat"]||[]).push([[0],{222:function(e,n,t){e.exports=t.p+"static/media/avatar.315cf354.png"},244:function(e,n,t){e.exports=t(419)},250:function(e,n,t){},266:function(e,n,t){},419:function(e,n,t){"use strict";t.r(n);t(245);var a=t(0),r=t.n(a),c=t(52),o=t.n(c),l=(t(250),t(25)),s=t(144),i=t(112),u=t(440),m=t(37),d=t(439),g=t(431),f=t(78),p=t(429),E=t(420),b=t(441),h=t(430),v=t(80),y=t.n(v),O=t(232),C=(t(266),t(436)),j=t(435),w=t(432),S=t(233),k=function(e){var n=e.users,t=e.toggleConnection,a=e.connectedTo,c=e.connecting,o="https://avatars.dicebear.com/api/human/moneychat.svg";return r.a.createElement(d.a.Column,{width:5},r.a.createElement(C.a,{fluid:!0},r.a.createElement(C.a.Content,{header:"Online Users"}),r.a.createElement(C.a.Content,{textAlign:"left"},n.length&&r.a.createElement(j.a,{divided:!0,verticalAlign:"middle",size:"large"},n.map((function(e){return r.a.createElement(j.a.Item,{key:e.userName},r.a.createElement(j.a.Content,{floated:"right"},r.a.createElement(E.a,{onClick:function(){t(e.userName)},disabled:!!a&&a!==e.userName,loading:a===e.userName&&c},a===e.userName?"Disconnect":"Connect")),r.a.createElement(w.a,{trigger:r.a.createElement(S.a,{avatar:!0,src:o})},r.a.createElement(w.a.Header,null,"A Money Chat User"),r.a.createElement(w.a.Content,{image:!0},r.a.createElement(S.a,{wrapped:!0,size:"medium",src:o}),r.a.createElement(w.a.Description,null,r.a.createElement(u.a,null,e.userName),r.a.createElement("p",null,"Payment Pointer: ",e.pointer),r.a.createElement("p",null,JSON.stringify(e,null,2))))),r.a.createElement(j.a.Content,null,r.a.createElement(j.a.Header,null,e.userName)))})))||r.a.createElement(b.a,null,"There are no users Online"))))},N=t(428),M=t(437),x=t(434),A=t(438),D=t(222),P=t.n(D),T=function(e){var n=e.messages,t=e.connectedTo,a=e.message,c=e.setMessage,o=e.sendMsg,l=e.me;return r.a.createElement(d.a.Column,{width:11},r.a.createElement(N.a,null,r.a.createElement(M.a,{warning:!0},r.a.createElement(M.a.Header,null,"Nothing here is private! All messages are sent to everyone on this site.")),r.a.createElement(C.a,{fluid:!0},r.a.createElement(C.a.Content,{header:t||"Not chatting with anyone currently"}),r.a.createElement(C.a.Content,null,t&&n[t]?r.a.createElement(x.a.Group,null,n[t].map((function(e){var n=e.sender,t=e.message,a=e.time;return r.a.createElement(x.a,{key:"msg-".concat(n,"-").concat(a)},r.a.createElement(x.a.Avatar,{src:P.a}),r.a.createElement(x.a.Content,null,r.a.createElement(x.a.Author,null,r.a.createElement(f.a,{pointing:n===l?"right":"left"},n===l?"Me":n)),r.a.createElement(x.a.Metadata,null,r.a.createElement("span",null,Object(A.a)(new Date(a),new Date))),r.a.createElement(x.a.Text,null,t)))}))):r.a.createElement(b.a,{placeholder:!0},r.a.createElement(u.a,{icon:!0},r.a.createElement(m.a,{name:"discussions"}),"No messages available yet")),r.a.createElement(g.a,null,r.a.createElement(p.a,{fluid:!0,type:"text",value:a,onChange:function(e){return c(e.target.value)},placeholder:"Type message",action:!0},r.a.createElement("input",null),r.a.createElement(E.a,{color:"teal",disabled:!a,onClick:o},r.a.createElement(m.a,{name:"send"}),"Send Message")))))))},z=t(231),F=t.n(z),B=t(110);var I=function(){var e=Object(B.b)().isMonetized;return r.a.createElement(a.Fragment,null,e?r.a.createElement("div",null,"Monetization Enabled. Thanks for your support!"):r.a.createElement("div",null,"You do not have monetization enabled. To get the full experience please",r.a.createElement("a",{href:"https://webmonetization.org/docs/getting-started.html",target:"_blank",rel:"noopener noreferrer"},"Get Started!")))},U={iceServers:[{url:"stun:stun.1.google.com:19302"}]},H=function(e){var n=e.connection,t=e.updateConnection,c=(e.channel,e.updateChannel),o=Object(a.useState)(!1),v=Object(l.a)(o,2),C=v[0],j=v[1],w=Object(a.useState)([]),S=Object(l.a)(w,2),N=S[0],M=S[1],x=Object(a.useState)(!1),A=Object(l.a)(x,2),D=A[0],P=A[1],z=Object(a.useState)(""),B=Object(l.a)(z,2),H=B[0],L=B[1],J=Object(a.useState)(""),R=Object(l.a)(J,2),W=R[0],_=R[1],G=Object(a.useState)(!1),$=Object(l.a)(G,2),q=$[0],V=$[1],Y=Object(a.useState)([]),K=Object(l.a)(Y,2),Q=K[0],X=K[1],Z=Object(a.useState)(""),ee=Object(l.a)(Z,2),ne=ee[0],te=ee[1],ae=Object(a.useState)(!1),re=Object(l.a)(ae,2),ce=re[0],oe=re[1],le=Object(a.useState)(null),se=Object(l.a)(le,2),ie=se[0],ue=se[1],me=Object(a.useRef)(),de=Object(a.useState)(""),ge=Object(l.a)(de,2),fe=ge[0],pe=ge[1],Ee=Object(a.useRef)({}),be=Object(a.useState)({}),he=Object(l.a)(be,2),ve=he[0],ye=he[1],Oe=Object(a.useRef)(null);function Ce(){j(!0),Oe.current.subscribe("demo"),console.log("subscribed to demo topic")}function je(e){console.log("onMessageArrived: "+e.payloadString);var n=JSON.parse(e.payloadString);M((function(e){return[].concat(Object(i.a)(e),[n])}))}Object(a.useEffect)((function(){var e="bot-demo-ws-"+parseInt(100*Math.random());Oe.current=new F.a.Client("mqtt.bitcoinofthings.com",Number("8884"),e),Oe.current.onMessageArrived=je,Oe.current.connect({useSSL:!0,userName:"demo",password:"demo",onSuccess:Ce})}),[]),Object(a.useEffect)((function(){var e=N.pop();if(e)switch(console.log("effect data"),console.log(e),e.type){case"connect":j(!0);break;case"login":e.name===H?Ae(e):(Ne(e.users[0]),H&&Se({type:"updateUsers",key:H,userName:H,pointer:W}));break;case"updateUsers":Ne(e);break;case"removeUser":Me(e);break;case"offer":De(e);break;case"answer":e.sender?Pe(e):console.error("INVALID answer message");break;case"candidate":Te(e);break;case"channelMessage":ke(e);break;default:console.log("".concat(e.type," type not handled in switch")),console.log(e)}}),[N]);var we=function(){ue(null)},Se=function(e){console.log("sending"),console.log(e),Oe.current.publish("demo",JSON.stringify(e))},ke=function(e){xe(e)},Ne=function(e){Me(e),e.avatar="https://avatars.dicebear.com/api/human/".concat(e.userName,".svg"),X((function(n){return[].concat(Object(i.a)(n),[e])}))},Me=function(e){X((function(n){return n.filter((function(n){return n.userName!==e.userName}))}))},xe=function(e){if(e.recipient===H||e.sender===H){var n=e,t=n.sender,a=n.recipient,r=t===H?a:t,c=Ee.current[r];if(c){console.log("previous convo"),c=[].concat(Object(i.a)(c),[n]);var o=Object.assign({},ve,Object(s.a)({},r,c));Ee.current=o,ye(o),console.log(o)}else{console.log("new convo"),c=Object(s.a)({},r,[n]);var l=Object.assign({},ve,c);Ee.current=l,ye(l),console.log(l)}}},Ae=function(e){var n=e.success,a=e.message,o=e.users;if(V(!1),n){ue(r.a.createElement(y.a,{success:!0,title:"Hello ".concat(H),timeout:3e3,onConfirm:we,onCancel:we},"Logged in successfully!")),P(!0),Ne(o[0]);var l=new RTCPeerConnection(U);l.ondatachannel=function(e){console.log("Data channel is created!");var n=e.channel;n.onopen=function(){console.log("Data channel is open and ready to be used.")},n.onmessage=xe,c(n)},t(l)}else ue(r.a.createElement(y.a,{warning:!0,confirmBtnBsStyle:"danger",title:"Failed",onConfirm:we,onCancel:we},a))},De=function(e){e.peer===H&&(te(e.sender),me.current=e.sender,Se({type:"answer",answer:n.localDescription,sender:H,peer:e.sender}))},Pe=function(e){e.sender===H&&console.log("thanks for accepting. you are now connected to ".concat(e.peer))},Te=function(e){e.candidate;console.log("we dont do ice candidates")};return r.a.createElement("div",{className:"App"},ie,r.a.createElement(u.a,{as:"h2",icon:!0},r.a.createElement(m.a,{name:"users"}),r.a.createElement("a",{href:"https://webmonetization.org/docs/getting-started.html",target:"_blank",rel:"noopener noreferrer"},"Web Monetization")," Chat"),r.a.createElement(I,null),C&&r.a.createElement(a.Fragment,null,r.a.createElement(d.a,{centered:!0,columns:2},r.a.createElement(d.a.Column,null,!D&&r.a.createElement(r.a.Fragment,null,r.a.createElement(g.a,null,r.a.createElement(g.a.Field,null,r.a.createElement(f.a,{pointing:"below"},"Username is your chat alias (authentication not enabled yet)"),r.a.createElement(p.a,{icon:"user",iconPosition:"left",disabled:q,type:"text",onChange:function(e){return L(e.target.value)},placeholder:"Username...",action:!0,autoFocus:!0})),r.a.createElement(g.a.Field,null,r.a.createElement(f.a,{pointing:"below"},r.a.createElement("a",{href:"https://paymentpointers.org/",target:"_blank",rel:"noopener noreferrer"},"Payment Pointer")," is your (optional) wallet address where you get paid when you chat"),r.a.createElement(p.a,{icon:"dollar",iconPosition:"left",disabled:q,type:"text",onChange:function(e){return _(e.target.value)},placeholder:"Payment Pointer",action:!0})),r.a.createElement(E.a,{color:"teal",disabled:!H||q,onClick:function(){V(!0),Se({type:"login",name:H,success:!0,message:"I just logged in",users:[{key:H,userName:H,pointer:W}]})}},r.a.createElement(m.a,{name:"sign-in"}),"Login")))||r.a.createElement(b.a,{raised:!0,textAlign:"center",color:"olive"},"Logged In as: ",H," ",W))),r.a.createElement(d.a,null,r.a.createElement(k,{users:Q,toggleConnection:function(e){console.log("toggleConnection"),me.current===e?(oe(!0),te(""),me.current="",oe(!1)):(oe(!0),te(e),me.current=e,function(e){var t=n.createDataChannel("messenger");t.onerror=function(e){ue(r.a.createElement(y.a,{warning:!0,confirmBtnBsStyle:"danger",title:"Failed",onConfirm:we,onCancel:we},"An error has occurred."))},t.onmessage=xe,c(t),n.createOffer().then((function(e){return n.setLocalDescription(e)})).then((function(){return Se({type:"offer",offer:n.localDescription,sender:H,peer:e})})).catch((function(e){return ue(r.a.createElement(y.a,{warning:!0,confirmBtnBsStyle:"danger",title:"Failed",onConfirm:we,onCancel:we},"An error has occurred."))}))}(e),oe(!1))},connectedTo:ne,connection:ce}),r.a.createElement(T,{messages:ve,connectedTo:ne,message:fe,setMessage:pe,sendMsg:function(){var e=Object(O.a)(new Date,"yyyy-MM-dd'T'HH:mm:ss.SSSxxx"),n=me.current;Se({type:"channelMessage",time:e,message:fe,sender:H,recipient:n||"group"}),pe("")},me:H})))||r.a.createElement(h.a,{size:"massive",active:!0,inline:"centered"},"Connecting to messaging service..."))},L=function(){return r.a.createElement(W,null,(function(e){var n=e.connection,t=e.updateConnection;return r.a.createElement(_,null,(function(e){var a=e.channel,c=e.updateChannel;return r.a.createElement(H,{connection:n,updateConnection:t,channel:a,updateChannel:c})}))}))},J=Object(a.createContext)({connection:null,updateConnection:function(){}}),R=Object(a.createContext)({channel:null,updateChannel:function(){}}),W=J.Consumer,_=R.Consumer,G=function(){var e=Object(a.useState)(null),n=Object(l.a)(e,2),t=n[0],c=n[1],o=Object(a.useState)(null),s=Object(l.a)(o,2),i=s[0],u=s[1];return r.a.createElement(J.Provider,{value:{connection:t,updateConnection:function(e){c(e)}}},r.a.createElement(R.Provider,{value:{channel:i,updateChannel:function(e){u(e)}}},r.a.createElement(B.a,{paymentPointer:"$coil.xrptipbot.com/da75ae04-5c0c-4662-8ce6-5470a4127d97"},r.a.createElement(L,null))))};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));o.a.render(r.a.createElement(G,null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()}))}},[[244,1,2]]]);
//# sourceMappingURL=main.194c34d0.chunk.js.map