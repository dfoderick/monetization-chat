(this["webpackJsonpmoney-chat"]=this["webpackJsonpmoney-chat"]||[]).push([[0],{224:function(e,t,n){e.exports=n.p+"static/media/avatar.315cf354.png"},248:function(e,t,n){e.exports=n(423)},254:function(e,t,n){},270:function(e,t,n){},423:function(e,t,n){"use strict";n.r(t);n(249);var a=n(0),r=n.n(a),o=n(52),c=n.n(o),l=(n(254),n(25)),i=n(144),s=n(112),u=n(37),m=n(444),d=n(443),p=n(435),g=n(79),f=n(433),h=n(424),b=n(445),E=n(434),v=n(81),y=n.n(v),O=n(234),j=(n(270),n(210)),C=n(211),w=n(237),S=n(235),k=n(440),N=n(439),M=n(436),x=n(236),A={},P=function(e){Object(w.a)(n,e);var t=Object(S.a)(n);function n(){return Object(j.a)(this,n),t.apply(this,arguments)}return Object(C.a)(n,[{key:"componentDidMount",value:function(){document.monetization.addEventListener("monetizationprogress",this.handleMoney)}},{key:"componentWillUnmount",value:function(){document.monetization.removeEventListener("monetizationprogress",this.handleMoney)}},{key:"handleMoney",value:function(e){var t=e.detail,n=t.assetScale,a=A[t.paymentPointer];a||(a=0),a+=t.amount*Math.pow(10,-n),A[t.paymentPointer]=a}},{key:"render",value:function(){var e=this.props,t=e.users,n=e.toggleConnection,a=e.connectedTo,o=e.connecting,c=A["$coil.xrptipbot.com/da75ae04-5c0c-4662-8ce6-5470a4127d97"],l=c?c.toFixed(9):0;return r.a.createElement(d.a.Column,{width:5},"Platform $",l,r.a.createElement(k.a,{fluid:!0},r.a.createElement(k.a.Content,{header:"Online Users"}),r.a.createElement(k.a.Content,{textAlign:"left"},t.length&&r.a.createElement(N.a,{divided:!0,verticalAlign:"middle",size:"large"},t.map((function(e){var t=A[e.pointer],c=t?t.toFixed(9):0;return r.a.createElement(N.a.Item,{key:e.userName},r.a.createElement(N.a.Content,{floated:"right"},r.a.createElement(h.a,{onClick:function(){n(e.userName)},disabled:!!a&&a!==e.userName,loading:a===e.userName&&o},a===e.userName?"Disconnect":"Connect")),r.a.createElement(M.a,{trigger:r.a.createElement(x.a,{avatar:!0,src:e.avatar})},r.a.createElement(M.a.Header,null,"A Money Chat User"),r.a.createElement(M.a.Content,{image:!0},r.a.createElement(x.a,{wrapped:!0,size:"medium",src:e.avatar}),r.a.createElement(M.a.Description,null,r.a.createElement(m.a,null,e.userName),r.a.createElement("p",null,"Payment Pointer: ",e.pointer),r.a.createElement("p",null,"Amount you have paid to this user: ",c),r.a.createElement("p",null,JSON.stringify(e,null,2))))),r.a.createElement(N.a.Content,null,r.a.createElement(N.a.Header,null,e.userName," $",c)))})))||r.a.createElement(b.a,null,"There are no users Online"))))}}]),n}(r.a.Component),z=n(432),D=n(441),F=n(438),T=n(442),B=n(224),L=n.n(B),U=function(e){var t=e.messages,n=e.connectedTo,a=e.message,o=e.setMessage,c=e.sendMsg,l=e.me;return r.a.createElement(d.a.Column,{width:11},r.a.createElement(z.a,null,r.a.createElement(D.a,{warning:!0},r.a.createElement(D.a.Header,null,"Nothing here is private! All messages are sent to everyone on this site.")),r.a.createElement(k.a,{fluid:!0},r.a.createElement(k.a.Content,{header:n||"Not chatting with anyone currently"}),r.a.createElement(k.a.Content,null,n&&t[n]?r.a.createElement(F.a.Group,null,t[n].map((function(e){var t=e.sender,n=e.message,a=e.time;return r.a.createElement(F.a,{key:"msg-".concat(t,"-").concat(a)},r.a.createElement(F.a.Avatar,{src:L.a}),r.a.createElement(F.a.Content,null,r.a.createElement(F.a.Author,null,r.a.createElement(g.a,{pointing:t===l?"right":"left"},t===l?"Me":t)),r.a.createElement(F.a.Metadata,null,r.a.createElement("span",null,Object(T.a)(new Date(a),new Date))),r.a.createElement(F.a.Text,null,n)))}))):r.a.createElement(b.a,{placeholder:!0},r.a.createElement(m.a,{icon:!0},r.a.createElement(u.a,{name:"discussions"}),"No messages available yet")),r.a.createElement(p.a,null,r.a.createElement(f.a,{fluid:!0,type:"text",value:a,onChange:function(e){return o(e.target.value)},placeholder:"Type message",action:!0},r.a.createElement("input",null),r.a.createElement(h.a,{color:"teal",disabled:!a,onClick:c},r.a.createElement(u.a,{name:"send"}),"Send Message")))))))},H=n(233),I=n.n(H),$=n(63);var J=function(){var e=Object($.b)().isMonetized;return r.a.createElement(a.Fragment,null,e?r.a.createElement("div",null,"Monetization Enabled. Thanks for your support!"):r.a.createElement("div",null,"You do not have monetization enabled. To get the full experience please",r.a.createElement("a",{href:"https://webmonetization.org/docs/getting-started.html",target:"_blank",rel:"noopener noreferrer"},"Get Started!")))};var Y=function(e){var t=e.connection,n=e.updateConnection,o=(e.channel,e.updateChannel),c=Object(a.useState)(!1),v=Object(l.a)(c,2),j=v[0],C=v[1],w=Object(a.useState)([]),S=Object(l.a)(w,2),k=S[0],N=S[1],M=Object(a.useState)(!1),x=Object(l.a)(M,2),A=x[0],z=x[1],D=Object(a.useState)(""),F=Object(l.a)(D,2),T=F[0],B=F[1],L=Object(a.useState)("$coil.xrptipbot.com/da75ae04-5c0c-4662-8ce6-5470a4127d97"),H=Object(l.a)(L,2),$=H[0],Y=H[1],R=Object(a.useState)(!1),W=Object(l.a)(R,2),_=W[0],G=W[1],q=Object(a.useState)([]),V=Object(l.a)(q,2),K=V[0],Q=V[1],X=Object(a.useState)(""),Z=Object(l.a)(X,2),ee=Z[0],te=Z[1],ne=Object(a.useState)(!1),ae=Object(l.a)(ne,2),re=ae[0],oe=ae[1],ce=Object(a.useState)(null),le=Object(l.a)(ce,2),ie=le[0],se=le[1],ue=Object(a.useRef)(),me=Object(a.useState)(""),de=Object(l.a)(me,2),pe=de[0],ge=de[1],fe=Object(a.useRef)({}),he=Object(a.useState)({}),be=Object(l.a)(he,2),Ee=be[0],ve=be[1],ye=Object(a.useRef)(null);function Oe(){C(!0),ye.current.subscribe("demo"),console.log("subscribed to demo topic")}function je(e){console.log("onMessageArrived: "+e.payloadString);var t=JSON.parse(e.payloadString);N((function(e){return[].concat(Object(s.a)(e),[t])}))}Object(a.useEffect)((function(){var e="bot-demo-ws-"+parseInt(100*Math.random());ye.current=new I.a.Client("mqtt.bitcoinofthings.com",Number("8884"),e),ye.current.onMessageArrived=je,ye.current.connect({useSSL:!0,userName:"demo",password:"demo",onSuccess:Oe})}),[]),Object(a.useEffect)((function(){var e=k.pop();if(e)switch(console.log(e),e.type){case"connect":C(!0);break;case"login":e.name===T?xe(e):(ke(e.users[0]),T&&we({type:"updateUsers",key:T,userName:T,pointer:$}));break;case"updateUsers":ke(e);break;case"removeUser":Ne(e);break;case"offer":Ae(e);break;case"answer":e.sender?ze(e):console.error("INVALID answer message");break;case"candidate":De(e);break;case"channelMessage":Se(e);break;default:console.log("".concat(e.type," type not handled in switch")),console.log(e)}}),[k]);var Ce=function(){se(null)},we=function(e){ye.current.publish("demo",JSON.stringify(e))},Se=function(e){Me(e)},ke=function(e){Ne(e),e.avatar="https://avatars.dicebear.com/api/human/".concat(e.userName,".svg"),e.paidAmount=0,Q((function(t){return[].concat(Object(s.a)(t),[e])}))},Ne=function(e){Q((function(t){return t.filter((function(t){return t.userName!==e.userName}))}))},Me=function(e){if(e.recipient===T||e.sender===T){var t=e,n=t.sender,a=t.recipient,r=n===T?a:n,o=fe.current[r];if(o){o=[].concat(Object(s.a)(o),[t]);var c=Object.assign({},Ee,Object(i.a)({},r,o));fe.current=c,ve(c)}else{o=Object(i.a)({},r,[t]);var l=Object.assign({},Ee,o);fe.current=l,ve(l)}}},xe=function(e){var t=e.success,a=e.message,c=e.users;if(G(!1),t){se(r.a.createElement(y.a,{success:!0,title:"Hello ".concat(T),timeout:3e3,onConfirm:Ce,onCancel:Ce},"Logged in successfully!")),z(!0),ke(c[0]);var l=new RTCPeerConnection(null);l.ondatachannel=function(e){console.log("Data channel is created!");var t=e.channel;t.onopen=function(){console.log("Data channel is open and ready to be used.")},t.onmessage=Me,o(t)},n(l)}else se(r.a.createElement(y.a,{warning:!0,confirmBtnBsStyle:"danger",title:"Failed",onConfirm:Ce,onCancel:Ce},a))},Ae=function(e){e.peer===T&&(te(e.sender),ue.current=e.sender,we({type:"answer",answer:t.localDescription,sender:T,pointer:$,peer:e.sender}))},Pe=function(e){document.querySelector('meta[name="monetization"]').setAttribute("content",e),console.log("Now paying to ".concat(e))},ze=function(e){e.sender===T&&(console.log("You accepted the offer. Now connected to ".concat(e.peer)),e.pointer||console.error("You not have a pointer.")),e.peer===T&&(console.log("Your offer was accepted. You are now connected to ".concat(e.sender)),e.pointer?Pe(e.pointer):console.error("".concat(e.sender," does not have a pointer")))},De=function(e){e.candidate;console.log("we dont do ice candidates")};return r.a.createElement("div",{className:"App"},r.a.createElement("div",{className:"align-left"},r.a.createElement(u.a,{name:"github"},r.a.createElement("a",{href:"https://github.com/dfoderick/money-chat/",target:"_blank",rel:"noopener noreferrer"},"GitHub"))),ie,r.a.createElement(m.a,{as:"h2",icon:!0},r.a.createElement(u.a,{name:"users"}),r.a.createElement("a",{href:"https://webmonetization.org/docs/getting-started.html",target:"_blank",rel:"noopener noreferrer"},"Web Monetization")," Chat"),r.a.createElement(J,null),j&&r.a.createElement(a.Fragment,null,r.a.createElement(d.a,{centered:!0,columns:2},r.a.createElement(d.a.Column,null,!A&&r.a.createElement(r.a.Fragment,null,r.a.createElement(p.a,null,r.a.createElement(p.a.Field,null,r.a.createElement(g.a,{pointing:"below"},"Username is your chat alias (authentication not enabled yet)"),r.a.createElement(f.a,{icon:"user",iconPosition:"left",disabled:_,type:"text",onChange:function(e){return B(e.target.value)},placeholder:"Username...",action:!0,autoFocus:!0})),r.a.createElement(p.a.Field,null,r.a.createElement(g.a,{pointing:"below"},r.a.createElement("a",{href:"https://paymentpointers.org/",target:"_blank",rel:"noopener noreferrer"},"Payment Pointer")," is your (optional) wallet address where you get paid when you chat. Default is platform for testing."),r.a.createElement(f.a,{icon:"dollar",iconPosition:"left",value:$,disabled:_,type:"text",onChange:function(e){return Y(e.target.value)},placeholder:"Payment Pointer",action:!0})),r.a.createElement(h.a,{color:"teal",disabled:!T||_,onClick:function(){G(!0),we({type:"login",name:T,success:!0,message:"I just logged in",users:[{key:T,userName:T,pointer:$}]})}},r.a.createElement(u.a,{name:"sign-in"}),"Login")))||r.a.createElement(b.a,{raised:!0,textAlign:"center",color:"olive"},"Logged In as: ",T," ",$))),r.a.createElement(d.a,null,r.a.createElement(P,{users:K,toggleConnection:function(e){ue.current===e?(oe(!0),te(""),Pe("$coil.xrptipbot.com/da75ae04-5c0c-4662-8ce6-5470a4127d97"),ue.current="",oe(!1)):(oe(!0),te(e),ue.current=e,function(e){var n=t.createDataChannel("messenger");n.onerror=function(e){se(r.a.createElement(y.a,{warning:!0,confirmBtnBsStyle:"danger",title:"Failed",onConfirm:Ce,onCancel:Ce},"An error has occurred."))},n.onmessage=Me,o(n),t.createOffer().then((function(e){return t.setLocalDescription(e)})).then((function(){return we({type:"offer",offer:t.localDescription,sender:T,peer:e})})).catch((function(e){return se(r.a.createElement(y.a,{warning:!0,confirmBtnBsStyle:"danger",title:"Failed",onConfirm:Ce,onCancel:Ce},"An error has occurred."))}))}(e),oe(!1))},connectedTo:ee,connection:re}),r.a.createElement(U,{messages:Ee,connectedTo:ee,message:pe,setMessage:ge,sendMsg:function(){var e=Object(O.a)(new Date,"yyyy-MM-dd'T'HH:mm:ss.SSSxxx"),t=ue.current;we({type:"channelMessage",time:e,message:pe,sender:T,recipient:t||"group"}),ge("")},me:T})))||r.a.createElement(E.a,{size:"massive",active:!0,inline:"centered"},"Connecting to messaging service..."))},R=function(){return r.a.createElement(G,null,(function(e){var t=e.connection,n=e.updateConnection;return r.a.createElement(q,null,(function(e){var a=e.channel,o=e.updateChannel;return r.a.createElement(Y,{connection:t,updateConnection:n,channel:a,updateChannel:o})}))}))},W=Object(a.createContext)({connection:null,updateConnection:function(){}}),_=Object(a.createContext)({channel:null,updateChannel:function(){}}),G=W.Consumer,q=_.Consumer,V=function(){var e=Object(a.useState)(null),t=Object(l.a)(e,2),n=t[0],o=t[1],c=Object(a.useState)(null),i=Object(l.a)(c,2),s=i[0],u=i[1];return r.a.createElement(W.Provider,{value:{connection:n,updateConnection:function(e){o(e)}}},r.a.createElement(_.Provider,{value:{channel:s,updateChannel:function(e){u(e)}}},r.a.createElement($.a,{paymentPointer:"$coil.xrptipbot.com/da75ae04-5c0c-4662-8ce6-5470a4127d97"},r.a.createElement(R,null))))};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));c.a.render(r.a.createElement(V,null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()}))}},[[248,1,2]]]);
//# sourceMappingURL=main.15ace871.chunk.js.map